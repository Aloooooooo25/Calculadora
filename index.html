<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Calculadora de Juros Compostos - Completa</title>
  <meta name="description" content="Simule juros compostos com aportes mensais, taxa mensal ou anual, gráficos (montante, total investido e juros) e tabela detalhada. Ferramenta gratuita da RMT." />
  <meta name="keywords" content="calculadora juros compostos, simulador de investimentos, juros compostos online, calculadora financeira, RMT" />
  <meta name="author" content="RMT" />
  <meta name="robots" content="index,follow" />
  <link rel="canonical" href="https://aloooooooo25.github.io/Calculadora/" />

  <!-- Open Graph -->
  <meta property="og:title" content="Calculadora de Juros Compostos - Completa" />
  <meta property="og:description" content="Simule investimentos com ou sem aportes mensais e veja gráficos e tabela mês a mês." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://aloooooooo25.github.io/Calculadora/" />
  <meta property="og:image" content="https://aloooooooo25.github.io/Calculadora/og-image.png" />

  <!-- JSON-LD -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"Calculadora de Juros Compostos - Completa",
    "url":"https://aloooooooo25.github.io/Calculadora/",
    "applicationCategory":"FinanceApplication",
    "operatingSystem":"All",
    "publisher":{"@type":"Organization","name":"RMT"},
    "description":"Simule juros compostos com aportes mensais, taxa mensal ou anual, gráficos e tabela detalhada."
  }
  </script>

  <!-- Lib de gráficos -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root { --navy:#0b1e3d; --green:#00b37e; --green-2:#00a070; --bg:#0b1220; --card:#0f1930; --card-2:#0c1528; --text:#e6edf3; --muted:#a8b3c7; --border:#1d2b49; --shadow:0 10px 30px rgba(0,0,0,.35); }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;background:radial-gradient(1200px 800px at 10% 0%,#0f1a30 0%,#0b1220 50%,#0b1220 100%);color:var(--text)}
    header{position:sticky;top:0;z-index:50;backdrop-filter:blur(8px);background:linear-gradient(180deg,rgba(11,18,32,.92),rgba(11,18,32,.6));border-bottom:1px solid var(--border)}
    .wrap{max-width:1100px;margin:0 auto;padding:18px 16px;display:flex;align-items:center;gap:14px}

    /* Logo com fallback */
    .logo-img{width:56px;height:auto;display:block;border-radius:12px;box-shadow:0 6px 20px rgba(0,179,126,.28);}
    @media (max-width:480px){.logo-img{ width:48px; }}
    .logo-fallback{
      width:56px;height:56px;display:none;place-items:center;border-radius:12px;
      font-weight:900;letter-spacing:.5px;color:#e7fff6;
      background:linear-gradient(135deg,var(--navy),var(--green));box-shadow:0 6px 20px rgba(0,179,126,.28);
      border:1px solid rgba(255,255,255,.08)
    }

    .brand-title{font-weight:800;letter-spacing:.3px}
    .brand-sub{color:var(--muted);font-size:13px}
    main{padding:28px 16px 60px}
    .grid{max-width:1100px;margin:0 auto;display:grid;gap:20px;grid-template-columns:1fr}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow)}
    .card .head{padding:18px 18px 0}
    .card .body{padding:18px}
    .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media (max-width:700px){.form-grid{grid-template-columns:1fr}}
    .field{display:flex;flex-direction:column;gap:8px}
    .label{font-size:13px;color:var(--muted)}
    input[type=text], input[type=number], select{width:100%;padding:12px;border:1px solid var(--border);border-radius:12px;background:var(--card-2);color:var(--text);outline:none;transition:border .2s,box-shadow .2s}
    input:focus,select:focus{border-color:var(--green);box-shadow:0 0 0 3px rgba(0,179,126,.18)}
    .actions{display:flex;gap:10px;margin-top:6px;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid var(--border);background:var(--card-2);color:var(--text);padding:12px 14px;border-radius:12px;cursor:pointer;font-weight:700;transition:transform .05s,background .2s,border .2s}
    .btn:hover{background:#101b2c}.btn:active{transform:translateY(1px)}
    .btn.success{background:linear-gradient(180deg,var(--green),var(--green-2));color:#022017;border-color:transparent}
    .btn.danger{background:linear-gradient(180deg,#ff8a81,#ff6b61);color:#2b0b0a;border-color:transparent}
    .sum-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    @media (max-width:900px){.sum-grid{grid-template-columns:1fr}}
    .sum{padding:16px;border-radius:14px;background:linear-gradient(180deg,#0f1a2a,#0b1322);border:1px solid var(--border)}
    .sum .title{font-size:12px;color:var(--muted);margin-bottom:8px;text-transform:uppercase;letter-spacing:.5px}
    .sum .value{font-size:22px;font-weight:800}
    .sum .chip{font-size:12px;color:var(--green)}
    .charts{display:grid;grid-template-columns:1.2fr 1fr;gap:14px}
    @media (max-width:980px){.charts{grid-template-columns:1fr}}
    .chart-card{padding:14px;border-top:1px dashed var(--border)}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px 8px;border-bottom:1px solid var(--border);text-align:right}
    th{color:var(--muted);font-weight:600;text-align:right}
    td:first-child,th:first-child{text-align:left}
    .table-wrap{max-height:340px;overflow:auto;border:1px solid var(--border);border-radius:12px}
    .notice{color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <!-- Tenta carregar a logo; se falhar, mostra fallback "RMT" -->
      <img class="logo-img" id="logoImg"
           src="./rmt-logo-160-transparent.png?v=2"
           alt="RMT"
           onerror="this.style.display='none';document.getElementById('logoFallback').style.display='grid';" />
      <div id="logoFallback" class="logo-fallback">RMT</div>

      <div>
        <div class="brand-title">RMT</div>
        <div class="brand-sub">Calculadora de Juros Compostos - Completa</div>
      </div>
    </div>
  </header>

  <main>
    <div class="grid">
      <!-- Texto de apresentação (SEO) -->
      <section class="card">
        <div class="body">
          <h1 style="margin:0 0 8px 0">Calculadora de Juros Compostos - Completa</h1>
          <p style="margin:0">Simule seus investimentos com precisão: informe valor inicial, aportes mensais, taxa ao mês ou ao ano e período em meses/anos. Veja gráficos de evolução (linhas de Montante, Total investido e Juros acumulados), gráfico de composição e tabela mês a mês. Ferramenta gratuita da <strong>RMT</strong>.</p>
        </div>
      </section>

      <!-- Calculadora -->
      <section class="card">
        <div class="head"><h2>Parâmetros</h2></div>
        <div class="body">
          <div class="form-grid">
            <div class="field"><label class="label" for="valorInicial">Valor inicial</label><input id="valorInicial" type="text" inputmode="numeric" placeholder="R$ 0,00"></div>
            <div class="field"><label class="label" for="aporteMensal">Aporte mensal</label><input id="aporteMensal" type="text" inputmode="numeric" placeholder="R$ 0,00"></div>
            <div class="field"><label class="label" for="taxa">Taxa de juros (%)</label><input id="taxa" type="number" inputmode="decimal" min="0" step="0.0001" placeholder="Ex: 1"></div>
            <div class="field"><label class="label" for="taxaTipo">Tipo da taxa</label><select id="taxaTipo"><option value="mes">ao mês</option><option value="ano">ao ano</option></select></div>
            <div class="field"><label class="label" for="periodo">Período</label><input id="periodo" type="number" inputmode="numeric" min="1" step="1" value="12"></div>
            <div class="field"><label class="label" for="periodoTipo">Tipo de período</label><select id="periodoTipo"><option value="meses">Meses</option><option value="anos">Anos</option></select></div>
            <div class="field"><label class="label" for="momentoAporte">Momento do aporte</label><select id="momentoAporte"><option value="fim">Ao fim do mês (padrão)</option><option value="inicio">No início do mês</option></select></div>
          </div>
          <div class="actions"><button class="btn success" id="btnCalcular">Calcular</button><button class="btn danger" id="btnLimpar">Limpar</button></div>

          <div style="height:12px"></div>
          <div class="sum-grid">
            <div class="sum"><div class="title">Montante final</div><div class="value" id="outMontante">—</div></div>
            <div class="sum"><div class="title">Total investido</div><div class="value" id="outInvestido">—</div><div class="chip" id="outMeses">—</div></div>
            <div class="sum"><div class="title">Juros acumulados</div><div class="value" id="outJuros">—</div></div>
          </div>

          <div class="charts">
            <div class="chart-card"><canvas id="evolucaoChart" height="120"></canvas></div>
            <div class="chart-card"><canvas id="composicaoChart" height="120"></canvas></div>
          </div>

          <div style="height:14px"></div>
          <div class="table-wrap">
            <table>
              <thead><tr><th>Mês</th><th>Saldo inicial</th><th>Aporte</th><th>Juros do mês</th><th>Saldo final</th></tr></thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>

          <div class="actions" style="margin-top:10px"><button class="btn" id="btnCsv">Baixar CSV</button></div>
          <div class="notice">Conversão anual→mensal: <code>(1 + i_a)^(1/12) - 1</code>. Valores ilustrativos (ignoram taxas/IR).</div>
        </div>
      </section>
    </div>
  </main>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const $=(s)=>document.querySelector(s);
    const brl=(v)=>new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'}).format(v||0);

    // ---- Máscara BRL nos inputs de dinheiro ----
    const moneyInputs = [$('#valorInicial'), $('#aporteMensal')];
    function moneyFromInput(str){
      const digits = (str||'').replace(/[^\d]/g,''); // só números
      return (parseInt(digits||'0',10))/100;         // em reais
    }
    function maskMoney(e){
      const digits = e.target.value.replace(/[^\d]/g,'');
      const n = (parseInt(digits||'0',10))/100;
      e.target.value = brl(n);
    }
    moneyInputs.forEach(inp=>{
      inp.addEventListener('input', maskMoney);
      inp.addEventListener('focus', e=>e.target.select());
    });

    let lineChart, pieChart;
    const el={
      valorInicial:$('#valorInicial'), aporteMensal:$('#aporteMensal'),
      taxa:$('#taxa'), taxaTipo:$('#taxaTipo'),
      periodo:$('#periodo'), periodoTipo:$('#periodoTipo'),
      momentoAporte:$('#momentoAporte'),
      outMontante:$('#outMontante'), outInvestido:$('#outInvestido'),
      outJuros:$('#outJuros'), outMeses:$('#outMeses'),
      tbody:$('#tbody'),
      btnCalcular:$('#btnCalcular'), btnLimpar:$('#btnLimpar'), btnCsv:$('#btnCsv')
    };

    const efetivaMensal=(taxa,tipo)=>{
      const i=parseFloat(taxa||0)/100;
      if(!i) return 0;
      return tipo==='ano' ? Math.pow(1+i,1/12)-1 : i;
    };

    function calcular(){
      const pv  = moneyFromInput(el.valorInicial.value);
      const aport = moneyFromInput(el.aporteMensal.value);
      const nRaw = parseInt(el.periodo.value)||0;
      const n    = (el.periodoTipo.value==='anos')? nRaw*12 : nRaw;
      const i    = efetivaMensal(el.taxa.value, el.taxaTipo.value);
      const inicio = el.momentoAporte.value==='inicio';
      if(n<=0 || i<0){ renderResultados(0,0,0,0,[]); return; }

      let saldo=pv; let totalAportado=pv;
      const hist=[{mes:0,saldoIni:pv,aporte:0,jurosMes:0,saldoFim:pv}];

      for(let mes=1; mes<=n; mes++){
        const s0=saldo; let juros;
        if(inicio){ saldo+=aport; juros=saldo*i; saldo+=juros; }
        else { juros=saldo*i; saldo+=juros+aport; }
        totalAportado+=aport;
        hist.push({mes,saldoIni:s0,aporte:aport,jurosMes:juros,saldoFim:saldo});
      }

      renderResultados(saldo, totalAportado, saldo-totalAportado, n, hist);
    }

    function renderResultados(montante, investido, juros, n, hist){
      el.outMontante.textContent=brl(montante);
      el.outInvestido.textContent=brl(investido);
      el.outJuros.textContent=brl(juros);
      el.outMeses.textContent=n?`${n} mês(es)`:'—';

      // tabela
      el.tbody.innerHTML=hist.slice(0,480).map(r=>
        `<tr><td>${r.mes}</td><td>${brl(r.saldoIni)}</td><td>${brl(r.aporte)}</td><td>${brl(r.jurosMes)}</td><td>${brl(r.saldoFim)}</td></tr>`
      ).join('');

      // séries para o gráfico de linha
      const labels   = hist.map(r=>r.mes);
      const montes   = hist.map(r=>r.saldoFim);

      const investedSeries = [];
      let investedSoFar = hist[0]?.saldoFim || 0; // mês 0: só o inicial
      investedSeries.push(investedSoFar);
      for(let k=1;k<hist.length;k++){
        investedSoFar += hist[k].aporte; // soma aportes mês a mês
        investedSeries.push(investedSoFar);
      }
      const interestSeries = montes.map((m,idx)=> Math.max(0, m - investedSeries[idx]));

      try{
        if(lineChart) lineChart.destroy();
        lineChart = new Chart($('#evolucaoChart'),{
          type:'line',
          data:{
            labels,
            datasets:[
              {label:'Montante', data: montes, fill:true},
              {label:'Total investido', data: investedSeries, fill:false},
              {label:'Juros acumulados', data: interestSeries, fill:false}
            ]
          },
          options:{
            responsive:true,
            plugins:{
              legend:{ display:true },
              tooltip:{ callbacks:{ label:(ctx)=> `${ctx.dataset.label}: ${brl(ctx.parsed.y)}` } }
            },
            scales:{ y:{ ticks:{ callback:(v)=> brl(v) } } }
          }
        });
      }catch(e){}

      try{
        if(pieChart) pieChart.destroy();
        pieChart = new Chart($('#composicaoChart'),{
          type:'doughnut',
          data:{ labels:['Total investido','Juros'], datasets:[{ data:[Math.max(0,investido), Math.max(0,juros)] }] },
          options:{ responsive:true, plugins:{ legend:{ position:'bottom' } } }
        });
      }catch(e){}
    }

    // CSV
    const toCsv=(hist)=>{
      const header=['Mes','SaldoInicial','Aporte','JurosMes','SaldoFinal'];
      const rows=hist.map(r=>[r.mes,r.saldoIni,r.aporte,r.jurosMes,r.saldoFim]);
      return [header,...rows].map(r=>r.join(',')).join('\n');
    };

    el.btnCalcular.addEventListener('click', calcular);
    el.btnLimpar.addEventListener('click', ()=>{
      el.valorInicial.value=''; el.aporteMensal.value='';
      ['taxa','periodo'].forEach(id=>document.getElementById(id).value='');
      el.taxaTipo.value='mes'; el.periodoTipo.value='meses'; el.momentoAporte.value='fim';
      renderResultados(0,0,0,0,[]);
    });
    el.btnCsv.addEventListener('click', ()=>{
      const pv  = moneyFromInput(el.valorInicial.value);
      const aport = moneyFromInput(el.aporteMensal.value);
      const nRaw = parseInt(el.periodo.value)||0;
      const n    = (el.periodoTipo.value==='anos')? nRaw*12 : nRaw;
      const i    = efetivaMensal(el.taxa.value, el.taxaTipo.value);
      const inicio = el.momentoAporte.value==='inicio';

      let saldo=pv;
      const hist=[{mes:0,saldoIni:pv,aporte:0,jurosMes:0,saldoFim:pv}];
      for(let mes=1; mes<=n; mes++){
        const s0=saldo; let j;
        if(inicio){ saldo+=aport; j=saldo*i; saldo+=j; }
        else { j=saldo*i; saldo+=j+aport; }
        hist.push({mes,saldoIni:s0,aporte:aport,jurosMes:j,saldoFim:saldo});
      }

      const csv=toCsv(hist);
      const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
      const url=URL.createObjectURL(blob);
      const a=document.createElement('a');
      a.href=url; a.download='tabela-juros-compostos.csv'; a.click();
      URL.revokeObjectURL(url);
    });
  });
  </script>
</body>
</html>
